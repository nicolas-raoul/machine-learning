<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Machine Learning</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/aegif.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
<section>
  <h1>Machine Learning</h1>
  <p style="font-size: 150%">Nicolas Raoul, Aegif</p>
  <p>October 3, 2018</p>
</section><section data-markdown><textarea data-template>
  # Goal
  - Given an input, the goal is to generate the right output, based on a finite sample of input/output couples.
  - Examples:
     - Based on the content of a document, decide whether it *should* be tagged as OC or BC.
     - Based on an Alfresco user's viewing history, generate a list of documents they *want* to see.
</textarea></section><section data-markdown><textarea data-template>
  # Steps
  1. Gather a lot of sample data, ideally several thousand samples, more for difficult concepts with many inputs or many outputs.
  2. Choose a machine learning library that fits your needs.
  3. Train it using 80% (typically) of the sample data.
  4. Validate/test it using 20% of the sample data.
  5. Use the resulting function (obscure but fast calculation) in production.
</textarea></section><section data-markdown><textarea data-template>
  # Tools
  - Numpy: Python numerical library, used for its arrays
  - TensorFlow: Neural network library, very flexible
  - Keras: High-level interface over TensorFlow
</textarea></section><section data-markdown><textarea data-template>
  # What is a tensor?
  - A **tensor** is a multi-dimensional array.
  - Example: [[[1, 1, 1], [2, 2, 2]], [[3, 3, 3], [4, 4, 4]]]
  - The **shape** of a tensor a representation of its dimensions.
  - Example: The shape of the tensor above is [2, 2, 3] (yes, also a tensor).
  - Shapes sometimes have unknowns, for instance [[?,100,100,1].
  - Tensors are used everywhere in TensorFlow for very different things.
</textarea></section><section data-markdown><textarea data-template>
  # Neural networks
  - TensorFlow simulates a neural network:
     - Inputs
     - Intermediary layers of neurons
     - Outputs
  - All data coming in and out, and through each layer, is tensors.
</textarea></section><section data-markdown><textarea data-template>
  # Designing a neural network
  1. Determine what types of output you want.
  2. Make choices after looking at successful implementations for similar problems.
  3. Train, validate.
  4. Depending on accuracy found during validation, rethink choices or fine-tune, and repeat.
  5. Test.
</textarea></section><section data-markdown><textarea data-template>
  # Design choices
  - Input resolution, transformations (eg. grayscale)
  - Number and type (dense/pooling/dropout, conv2D, LSTM, etc) of intermediary layers
  - Number of neurons in each intermediary layer
  - Propagation (activation) function: ReLU, softmax, etc
  - Optimizer algorithm: GradientDescent, Adam, etc
  - Number of training epochs
</textarea></section><section data-markdown><textarea data-template>
  # Ex: VGG16 2014
  ![](https://heuritech.files.wordpress.com/2016/02/vgg16.png?w=940)
</textarea></section><section data-markdown><textarea data-template>
  # Ex: Xception 2016
  ![](https://culurciello.github.io/assets/nets/xception-net.jpg)
</textarea></section><section data-markdown><textarea data-template>
  # Hyperparameters

  - Finding the right hyperparameters (design choices) takes time, experience is important.
  - Some tools can help speed up the search for the optimal hyperparameters: https://github.com/hyperopt/hyperopt
</textarea></section><section data-markdown><textarea data-template>
  # Practice

  - Go to https://playground.tensorflow.org
  - Run simulations.
  - Play with the parameters.
  - Try to solve problems using as few neurons as possible.
  - Make your neural network resistant to noise.
</textarea></section><section data-markdown><textarea data-template>
  # Hands on
</textarea></section><section data-markdown><textarea data-template>
  # Getting started
  1. sudo apt-get install virtualenv
  2. virtualenv tensorflow_env
  3. pip install tensorflow keras
  4. Write and run Python script, for instance https://www.tensorflow.org/tutorials/keras/basic_classification
</textarea></section><section data-markdown><textarea data-template>
  # Choosing a challenge
  1. "It is not" bean recognition: Not enough samples
  2. BC or OC: Too easy
  3. Selfie or not
</textarea></section><section data-markdown><textarea data-template>
  Selfie: ![](https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Lueg_im_SWR1_Studio.jpg/320px-Lueg_im_SWR1_Studio.jpg)

  Not selfie: ![](https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/10th_and_Phillips%2C_Sioux_Falls%2C_South_Dakota.jpg/320px-10th_and_Phillips%2C_Sioux_Falls%2C_South_Dakota.jpg)
  ![](https://upload.wikimedia.org/wikipedia/commons/thumb/c/c6/160423_Assfalg_01.jpg/320px-160423_Assfalg_01.jpg)
</textarea></section><section data-markdown><textarea data-template>
  # Getting data
  1. Downloaded sample pictures from Wikimedia selfie categories.
  2. Downloaded random pictures.
  3. Manually fixed misclassified pictures.
  4. In total I gathered 291 selfies and 1102 non-selfies.
  5. More data would lead to better prediction.
</textarea></section><section data-markdown><textarea data-template>
  # Splitting the data
  - 80% for training, 10% for validation, 10% for test.
  - If you have millions of samples, using most of the data for training is acceptable.
  - Never use validation pictures for training, or test pictures for validation, or vice versa.
</textarea></section><section data-markdown><textarea data-template>
  # Design choices
  - Convert images to grayscale.
  - Resize all images to 20 pixels x 20 pixels.
  - Neural network with 4 layers.
</textarea></section><section data-markdown><textarea data-template>
# Code
1. Loading and pre-processing of the data.
2. Definition of the model (see next slide).
3. Training.
4. Validation.
5. Output weights (to use in production) and statistics.
</textarea></section><section data-markdown><textarea data-template>
# Code
```
model = keras.Sequential([
    Conv2D(filters=64, kernel_size=2, padding='same', activation='relu', input_shape=(thumbnail_height, thumbnail_width, 1)),
    MaxPooling2D(pool_size=2),
    Dropout(0.3),

    Conv2D(filters=32, kernel_size=2, padding='same', activation='relu'),
    MaxPooling2D(pool_size=2),
    Dropout(0.3),

    Flatten(),
    Dense(256, activation=tf.nn.relu),
    Dropout(0.5),
    Dense(1, activation=tf.nn.sigmoid)
])

model.compile(optimizer=tf.train.AdamOptimizer(),
              loss='binary_crossentropy',
              metrics=['accuracy'])
```
</textarea></section><section data-markdown><textarea data-template>
# Code
- Full source code at https://github.com/nicolas-raoul/selfie-or-not
- Running for 10 epochs takes 1 hour.
</textarea></section><section data-markdown><textarea data-template>
  # Results
  Accuracy on test data: 86%
</textarea></section><section data-markdown><textarea data-template>
  ![](https://raw.githubusercontent.com/nicolas-raoul/selfie-or-not/master/results.png)
</textarea></section><section data-markdown><textarea data-template>
  # Actually using ML
</textarea></section><section data-markdown><textarea data-template>
  # Deploying to production

  1. Export from Python: `tf.saved_model.builder.SavedModelBuilder`
  2. Import from Java: `SavedModelBundle.load`

  Also usable from other languages such as JavaScript.
</textarea></section><section data-markdown><textarea data-template>
  # Performance (training)

  - Very slow, very CPU/GPU-intensive, memory-intensive if using a big network or big batches
  - Tips: Use a GPU, compile TensorFlow to match your hardware
</textarea></section><section data-markdown><textarea data-template>
  # Performance (production)

  - Extremely fast
  - Low memory
  - Size in Java is 80 MB, but can be reduced to 1.5MB
</textarea></section><section data-markdown><textarea data-template>
  # When to use ML?

  - When implementing a function:
     - with few inputs and few outputs,
     - that does not modify any state nor write anything,
     - with no human interaction nor configuration.
  - Must have at least 1000 input/output samples for each class.
</textarea></section><section data-markdown><textarea data-template>
  # When NOT to use ML?

  - When a performant algorithm could be written in less than a few weeks.
  - When errors would have harmful consequences.
</textarea></section><section data-markdown><textarea data-template>
  # What will you use ML for?
  ![](https://aegif.jp/images/top/illust17.png)
</textarea></section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				slideNumber: true,
				history: true,
				transitionSpeed: 'fast',
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
